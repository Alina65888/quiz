<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>SIBUR QUIZ BATTLE ¬∑ Production-ready Telegram Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!--
    –ü–†–û–î-–í–ï–†–°–ò–Ø –§–†–û–ù–¢–ï–ù–î–ê
    ----------------------
    –≠—Ç–æ—Ç —Ñ–∞–π–ª –≥–æ—Ç–æ–≤ –¥–ª—è:
    ‚Ä¢ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –Ω–∞ –ª—é–±–æ–º —Ö–æ—Å—Ç–∏–Ω–≥–µ (–≤ —Ç.—á. GitHub Pages)
    ‚Ä¢ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ Telegram Mini Apps
    ‚Ä¢ —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º API —Ä–µ–π—Ç–∏–Ω–≥–∞/–±–µ–π–¥–∂–µ–π —á–µ—Ä–µ–∑ /api/...

    –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –±—ç–∫–µ–Ω–¥—É:
    ‚Ä¢ GET  /api/profile/me
    ‚Ä¢ POST /api/duels/finish
    ‚Ä¢ GET  /api/leaderboard

    –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –±—ç–∫–µ–Ω–¥–∞ —Ñ—Ä–æ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ (localStorage).
  -->

  <style>
    :root {
      --sibur-teal: #009CA6;
      --sibur-teal-dark: #006D73;
      --sibur-teal-soft: #E3F6F7;
      --sibur-graphite: #00252B;
      --sibur-accent-yellow: #F7C948;

      --bg-main: #F3F7F8;
      --card-bg: #FFFFFF;
      --border-soft: #E2E8EA;
      --danger: #D94747;
      --success: #36A766;
      --radius-lg: 20px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #E2F5F6 0, #F7FAFB 55%, #EDF3F4 100%);
      color: var(--sibur-graphite);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .app {
      width: 100%;
      max-width: 480px;
      min-height: 100vh;
      background: radial-gradient(circle at top left, #FFFFFF 0%, #F4FBFC 45%, #E7F3F5 100%);
      border-radius: 28px;
      box-shadow: 0 18px 46px rgba(0, 40, 50, 0.28);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    header.app-header {
      padding: 16px 20px 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(135deg, var(--sibur-teal-dark), var(--sibur-teal));
      color: white;
    }

    .header-logo {
      font-weight: 800;
      letter-spacing: 0.08em;
      font-size: 16px;
    }

    .header-badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.4);
      text-transform: uppercase;
      opacity: 0.9;
    }

    main {
      flex: 1;
      padding: 18px 18px 22px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .screen {
      display: none;
      flex-direction: column;
      gap: 16px;
      height: 100%;
      opacity: 0;
      transform: translateY(8px) scale(0.99);
      transition: opacity 0.22s ease, transform 0.22s ease;
    }
    .screen.active {
      display: flex;
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    .card {
      background: rgba(255,255,255,0.98);
      border-radius: var(--radius-lg);
      padding: 16px 16px 14px;
      box-shadow: 0 10px 28px rgba(0, 40, 50, 0.12);
      border: 1px solid rgba(255,255,255,0.7);
    }

    .card-hero {
      background: radial-gradient(circle at top left,
      rgba(255,255,255,0.98),
      rgba(227,246,247,0.98));
      padding: 18px 18px 18px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .card-title {
      font-weight: 700;
      font-size: 18px;
      letter-spacing: 0.01em;
    }

    .card-subtitle {
      font-size: 13px;
      opacity: 0.8;
      margin-top: 4px;
      line-height: 1.5;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .pill-inline {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.04);
      font-size: 11px;
    }

    .btn {
      position: relative;
      overflow: hidden;
      border-radius: 999px;
      padding: 12px 16px;
      font-weight: 600;
      font-size: 15px;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      transition:
        transform 0.09s ease,
        box-shadow 0.09s ease,
        background 0.12s ease,
        filter 0.12s ease;
    }
    .btn::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at center, rgba(255,255,255,0.5), transparent 60%);
      opacity: 0;
      transition: opacity 0.18s ease;
    }
    .btn:active::after {
      opacity: 1;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--sibur-teal), var(--sibur-teal-dark));
      color: #fff;
      box-shadow: 0 10px 24px rgba(0, 95, 110, 0.4);
    }
    .btn-primary:active {
      transform: scale(0.97) translateY(1px);
      box-shadow: 0 6px 18px rgba(0, 70, 80, 0.4);
      filter: brightness(0.97);
    }
    .btn-secondary {
      background: rgba(255,255,255,0.96);
      border: 1px solid var(--border-soft);
      color: var(--sibur-teal-dark);
      box-shadow: 0 4px 10px rgba(0, 40, 50, 0.08);
    }
    .btn-small {
      padding-block: 8px;
      font-size: 13px;
    }

    .btn-row {
      display: flex;
      gap: 10px;
    }

    .profile-row {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .avatar {
      width: 46px;
      height: 46px;
      border-radius: 14px;
      background: linear-gradient(145deg, #FFFFFF, #E5F5F6);
      border: 2px solid rgba(0,156,166,0.35);
      box-shadow: 0 6px 16px rgba(0, 80, 90, 0.28);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 18px;
      color: var(--sibur-teal-dark);
      overflow: hidden;
    }
    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .profile-meta {
      font-size: 12px;
      opacity: 0.7;
    }

    .stats-row {
      display: flex;
      gap: 10px;
      margin-top: 8px;
      font-size: 12px;
      flex-wrap: wrap;
    }

    .chip {
      border-radius: 999px;
      padding: 4px 10px;
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(0, 156, 166, 0.15);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .chip span.icon {
      font-size: 14px;
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    .menu-item {
      border-radius: var(--radius-lg);
      background: white;
      padding: 10px 11px;
      border: 1px solid rgba(0, 0, 0, 0.03);
      box-shadow: 0 4px 10px rgba(0, 40, 50, 0.04);
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.1s ease;
    }
    .menu-item:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 16px rgba(0, 40, 50, 0.08);
      background: rgba(255, 255, 255, 0.98);
    }
    .menu-item-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .menu-item-subtitle {
      font-size: 11px;
      opacity: 0.7;
      line-height: 1.4;
    }
    .menu-pill {
      font-size: 10px;
      margin-top: 6px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(0, 156, 166, 0.08);
      color: var(--sibur-teal-dark);
      display: inline-block;
    }

    .footer-info {
      text-align: center;
      font-size: 11px;
      opacity: 0.7;
      line-height: 1.4;
    }

    .duel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      margin-bottom: 8px;
    }

    .versus-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .vs-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.7;
    }

    .score-chip {
      font-size: 13px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.04);
    }

    .timer-bar {
      position: relative;
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.06);
      overflow: hidden;
      margin-bottom: 12px;
    }

    .timer-fill {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 100%;
      border-radius: inherit;
      background: linear-gradient(90deg, var(--sibur-teal), var(--sibur-accent-yellow));
      transform-origin: left;
      transform: scaleX(1);
      transition: transform 0.1s linear;
    }

    .question-text {
      font-size: 17px;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .question-meta {
      font-size: 12px;
      opacity: 0.7;
      margin-bottom: 10px;
    }

    .answers {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .answer-btn {
      width: 100%;
      border-radius: 999px;
      padding: 10px 13px;
      border: 1px solid var(--border-soft);
      background: rgba(255,255,255,0.96);
      text-align: left;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      box-shadow: 0 4px 12px rgba(0, 40, 50, 0.06);
      transition: background 0.1s ease, border-color 0.1s ease, transform 0.06s ease, box-shadow 0.06s ease;
    }
    .answer-btn span.index {
      font-weight: 600;
      font-size: 11px;
      padding: 3px 6px;
      border-radius: 999px;
      background: rgba(0,156,166,0.12);
      color: var(--sibur-teal-dark);
      min-width: 20px;
      text-align: center;
    }
    .answer-btn span.text {
      flex: 1;
    }
    .answer-btn.correct {
      background: rgba(54, 167, 102, 0.12);
      border-color: rgba(54, 167, 102, 0.7);
      animation: answer-pop 0.25s ease;
    }
    .answer-btn.wrong {
      background: rgba(217, 71, 71, 0.10);
      border-color: rgba(217, 71, 71, 0.75);
      animation: answer-shake 0.25s ease;
    }
    .answer-btn.disabled {
      opacity: 0.75;
      cursor: default;
    }

    @keyframes answer-pop {
      0% { transform: scale(0.98); }
      60% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }

    @keyframes answer-shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-3px); }
      50% { transform: translateX(3px); }
      75% { transform: translateX(-2px); }
      100% { transform: translateX(0); }
    }

    .small-label {
      font-size: 11px;
      opacity: 0.7;
    }

    .result-main-score {
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 6px;
    }
    .result-status {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .result-delta {
      font-size: 12px;
      opacity: 0.8;
    }

    .list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 13px;
    }
    .list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .badge-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    .badge-card {
      border-radius: var(--radius-lg);
      padding: 9px 10px;
      background: white;
      border: 1px solid rgba(0, 0, 0, 0.04);
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
      box-shadow: 0 4px 10px rgba(0, 40, 50, 0.04);
    }
    .badge-pill {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(0, 156, 166, 0.09);
      align-self: flex-start;
    }
    .badge-card.locked {
      opacity: 0.55;
    }

    .leader-header-row {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      opacity: 0.7;
      margin-bottom: 6px;
    }
    .leader-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 13px;
    }
    .leader-row {
      display: grid;
      grid-template-columns: 26px 1fr auto;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.9);
      border: 1px solid rgba(0,0,0,0.03);
      box-shadow: 0 4px 10px rgba(0,40,50,0.06);
    }
    .leader-row.me {
      background: rgba(0,156,166,0.11);
      border-color: rgba(0,156,166,0.4);
      font-weight: 600;
    }
    .leader-pos {
      font-size: 12px;
      opacity: 0.7;
      text-align: center;
    }
    .leader-name {
      display: flex;
      flex-direction: column;
    }
    .leader-name-main {
      font-size: 13px;
    }
    .leader-name-sub {
      font-size: 11px;
      opacity: 0.7;
    }
    .leader-score {
      font-size: 13px;
      font-weight: 600;
      text-align: right;
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .overlay.active {
      display: flex;
    }
    .overlay-card {
      width: 100%;
      max-width: 360px;
      background: #FFFFFF;
      border-radius: 20px;
      padding: 18px 18px 16px;
      box-shadow: 0 18px 46px rgba(0,0,0,0.35);
    }

    @media (max-width: 520px) {
      .app {
        border-radius: 0;
        max-width: none;
        min-height: 100vh;
      }
      header.app-header {
        border-radius: 0;
      }
    }
  </style>
</head>
<body>
<div class="app">
  <header class="app-header">
    <div class="header-logo">SIBUR QUIZ</div>
    <div class="header-badge">MERCH BATTLE</div>
  </header>

  <main>
    <!-- Splash -->
    <section class="screen active" id="screen-splash">
      <div class="card card-hero">
        <div class="card-header">
          <div>
            <div class="card-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</div>
            <div class="card-subtitle" id="splash-subtitle">
              –ö–≤–∏–∑-–¥—É—ç–ª–∏ –ø–æ —Ü–µ–Ω–Ω–æ—Å—Ç—è–º, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏—è–º –°–ò–ë–£–†–∞.
              –í –ø—Ä–æ–¥-—Ä–µ–∂–∏–º–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Ä–µ–π—Ç–∏–Ω–≥ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –∞ –≤—Ö–æ–¥ ‚Äî —á–µ—Ä–µ–∑ Telegram.
            </div>
          </div>
        </div>
        <div style="margin-top: 12px; font-size: 12px; display: flex; flex-direction: column; gap: 4px;">
          <span>‚ö° –î—É—ç–ª—å ‚Äî 5 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Ç–µ–º–∞–º</span>
          <span>üèÖ –†–µ–π—Ç–∏–Ω–≥ –∏ –±–µ–π–¥–∂–∏ ‚Äî –æ–±—â–∏–µ –¥–ª—è –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</span>
          <span>üß† –ò–≥—Ä–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä—è–º–æ –∏–∑ Telegram –∫–∞–∫ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</span>
        </div>
      </div>

      <div class="card">
        <div class="section-title">–í—Ö–æ–¥</div>
        <p style="font-size: 13px; opacity: 0.8; margin-bottom: 10px;" id="splash-info">
          –ï—Å–ª–∏ –≤—ã –≤–Ω—É—Ç—Ä–∏ Telegram ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç. –í –±—Ä–∞—É–∑–µ—Ä–µ –∏–≥—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.
        </p>
        <div style="display:flex;flex-direction:column;gap:8px;">
          <button class="btn btn-primary" id="btn-enter">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
          <button class="btn btn-secondary btn-small" id="btn-demo-name">–î–µ–º–æ-—Ä–µ–∂–∏–º (—Ç–æ–ª—å–∫–æ —ç—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)</button>
        </div>
      </div>

      <div class="footer-info" id="splash-footer">
        –°—Ç–∞—Ç—É—Å: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ.<br>
        –í –±–æ–µ–≤–æ–π —Å—Ä–µ–¥–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å—Ç–∞—Ç—É—Å API.
      </div>
    </section>

    <!-- Main menu -->
    <section class="screen" id="screen-main">
      <div class="card card-hero">
        <div class="profile-row">
          <div class="avatar" id="player-avatar">S</div>
          <div>
            <div id="player-name" style="font-weight: 700;">–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –°–ò–ë–£–†</div>
            <div class="profile-meta" id="player-meta">–†–µ–π—Ç–∏–Ω–≥: 100 ¬∑ –î—É—ç–ª–µ–π: 0</div>
            <div class="stats-row">
              <div class="chip">
                <span class="icon">üèÖ</span><span id="player-rating-label">–ù–æ–≤–∏—á–æ–∫</span>
              </div>
              <div class="chip">
                <span class="icon">üéØ</span><span id="player-battles-label">0 –¥—É—ç–ª–µ–π</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="section-title">–ë—ã—Å—Ç—Ä–∞—è –¥—É—ç–ª—å</div>
        <p class="card-subtitle">
          5 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Ü–µ–Ω–Ω–æ—Å—Ç—è–º –°–ò–ë–£–†–∞, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º –∏ —ç–∫–æ–ª–æ–≥–∏–∏.
          –ü–æ–±–µ–∂–¥–∞–µ—Ç —Ç–æ—Ç, –∫—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –∏ —Ç–æ—á–Ω–µ–µ.
        </p>
        <div style="margin-top: 10px; display:flex; flex-direction:column; gap:8px;">
          <button class="btn btn-primary" id="btn-play-quick">–ò–≥—Ä–∞—Ç—å –¥—É—ç–ª—å</button>
          <button class="btn btn-secondary btn-small" id="btn-play-bot">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å –ò–ò-—Å–æ–ø–µ—Ä–Ω–∏–∫–æ–º</button>
        </div>
      </div>

      <div class="card">
        <div class="section-title">–í–∞—à–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div>
        <div class="menu-grid">
          <div class="menu-item" id="menu-leaderboard">
            <div class="menu-item-title">–†–µ–π—Ç–∏–Ω–≥ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
            <div class="menu-item-subtitle">–û–±—â–∏–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º. –í –¥–µ–º–æ ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è.</div>
            <div class="menu-pill">üèÜ –õ–∏–¥–µ—Ä–±–æ—Ä–¥</div>
          </div>
          <div class="menu-item" id="menu-badges">
            <div class="menu-item-title">–ë–µ–π–¥–∂–∏ —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π</div>
            <div class="menu-item-subtitle">‚Äú–ó–Ω–∞—Ç–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏‚Äù, ‚Äú–ò–Ω–Ω–æ–≤–∞—Ç–æ—Ä‚Äù –∏ –¥—Ä—É–≥–∏–µ –∑–≤–∞–Ω–∏—è.</div>
            <div class="menu-pill">‚≠ê –ö–æ–ª–ª–µ–∫—Ü–∏—è</div>
          </div>
          <div class="menu-item" id="menu-stats">
            <div class="menu-item-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            <div class="menu-item-subtitle">–ü–æ–±–µ–¥—ã, –ø–æ—Ä–∞–∂–µ–Ω–∏—è –∏ —Å–∏–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–æ–ø—Ü–∏—è –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è).</div>
            <div class="menu-pill">üìä –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>
          </div>
          <div class="menu-item" id="menu-settings">
            <div class="menu-item-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
            <div class="menu-item-subtitle">–ò–∑–º–µ–Ω–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è (—Å —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ).</div>
            <div class="menu-pill">‚öôÔ∏è –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>
          </div>
        </div>
      </div>

      <div class="footer-info" id="main-footer">
        –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ. –í –±–æ–µ–≤–æ–π —Å—Ä–µ–¥–µ —Ä–µ–π—Ç–∏–Ω–≥ –∏ –±–µ–π–¥–∂–∏ –æ–±—â–∏–µ.
      </div>
    </section>

    <!-- Duel screen -->
    <section class="screen" id="screen-duel">
      <div class="card">
        <div class="duel-header">
          <span class="small-label" id="duel-mode-label">–†–µ–∂–∏–º: –ë—ã—Å—Ç—Ä–∞—è –¥—É—ç–ª—å</span>
          <span class="small-label" id="duel-progress-label">–í–æ–ø—Ä–æ—Å 1 / 5</span>
        </div>

        <div class="versus-row">
          <div style="display:flex;align-items:center;gap:8px;">
            <div class="avatar" style="width:34px;height:34px;font-size:14px;" id="duel-player-avatar">P</div>
            <div style="font-size:12px;">
              <div id="duel-player-name" style="font-weight:600;">–í—ã</div>
              <div style="opacity:0.7;">–†–µ–π—Ç–∏–Ω–≥: <span id="duel-player-rating">100</span></div>
            </div>
          </div>
          <div style="text-align:center;">
            <div class="vs-label">–î—É—ç–ª—å</div>
            <div class="score-chip" id="duel-score-label">0 : 0</div>
          </div>
          <div style="display:flex;align-items:center;gap:8px;justify-content:flex-end;">
            <div style="font-size:12px;text-align:right;">
              <div id="duel-opponent-name" style="font-weight:600;">–°–æ–ø–µ—Ä–Ω–∏–∫</div>
              <div style="opacity:0.7;">–†–µ–π—Ç–∏–Ω–≥: <span id="duel-opponent-rating">100</span></div>
            </div>
            <div class="avatar" style="width:34px;height:34px;font-size:14px;background:linear-gradient(135deg,#ffffff,#FFE1B2);border-color:rgba(249,180,59,0.5);" id="duel-opponent-avatar">
              R
            </div>
          </div>
        </div>

        <div class="timer-bar">
          <div class="timer-fill" id="timer-fill"></div>
        </div>

        <div class="question-text" id="question-text">–í–æ–ø—Ä–æ—Å –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å.</div>
        <div class="question-meta" id="question-meta">–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ‚Äî</div>

        <div class="answers" id="answers-container"></div>
      </div>

      <div class="card">
        <div class="section-title">–ü–æ–¥—Å–∫–∞–∑–∫–∞</div>
        <p style="font-size:12px;opacity:0.8;" id="duel-hint">
          –í —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏ —Å–æ–ø–µ—Ä–Ω–∏–∫ ‚Äî –±–æ—Ç. –í –±–æ–µ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å—é–¥–∞ –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–æ–ª–ª–µ–≥.
        </p>
      </div>

      <div class="btn-row">
        <button class="btn btn-secondary btn-small" id="btn-duel-exit">–í—ã–π—Ç–∏</button>
        <button class="btn btn-small" id="btn-duel-skip">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–∞—É–Ω–¥</button>
      </div>
    </section>

    <!-- Result screen -->
    <section class="screen" id="screen-result">
      <div class="card card-hero">
        <div class="card-header">
          <div>
            <div class="card-title">–†–µ–∑—É–ª—å—Ç–∞—Ç –¥—É—ç–ª–∏</div>
            <div class="card-subtitle" id="result-subtitle">
              –•–æ—Ä–æ—à–∞—è –∏–≥—Ä–∞! –° –∫–∞–∂–¥–æ–π –¥—É—ç–ª—å—é –≤—ã –ª—É—á—à–µ –∑–Ω–∞–µ—Ç–µ –∫–æ–º–ø–∞–Ω–∏—é.
            </div>
          </div>
          <div class="pill-inline" id="result-mode-pill">–ë—ã—Å—Ç—Ä–∞—è –¥—É—ç–ª—å</div>
        </div>

        <div style="margin-top:10px;">
          <div class="result-main-score" id="result-score">3 : 2</div>
          <div class="result-status" id="result-status-label">–ü–æ–±–µ–¥–∞ üéâ</div>
          <div class="result-delta" id="result-delta-label">–†–µ–π—Ç–∏–Ω–≥: +15 ¬∑ –î—É—ç–ª–µ–π: +1</div>
        </div>
      </div>

      <div class="card">
        <div class="section-title">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
        <div class="list">
          <div class="list-item">
            <span>–¢–µ–∫—É—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥</span>
            <span class="pill-inline">üèÖ <span id="result-rating-value">115</span></span>
          </div>
          <div class="list-item">
            <span>–í—Å–µ–≥–æ –¥—É—ç–ª–µ–π</span>
            <span class="pill-inline">‚öîÔ∏è <span id="result-battles-value">1</span></span>
          </div>
          <div class="list-item">
            <span>–ü–æ–±–µ–¥—ã / –ø–æ—Ä–∞–∂–µ–Ω–∏—è</span>
            <span class="pill-inline">üéØ <span id="result-wl-value">1 / 0 / 0</span></span>
          </div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn btn-primary" id="btn-result-again">–°—ã–≥—Ä–∞—Ç—å –µ—â—ë –¥—É—ç–ª—å</button>
        <button class="btn btn-secondary" id="btn-result-main">–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
      </div>
    </section>

    <!-- Badges screen -->
    <section class="screen" id="screen-badges">
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">–ë–µ–π–¥–∂–∏ —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π</div>
            <div class="card-subtitle">–°–ø–∏—Å–æ–∫ –±–µ–π–¥–∂–µ–π –∏ —É—Å–ª–æ–≤–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è. –í –ø—Ä–æ–¥–µ –≤—ã–¥–∞—é—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º.</div>
          </div>
          <div class="pill-inline">
            ‚≠ê <span id="badges-count-label">0 –∏–∑ 5</span>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="badge-grid" id="badge-grid"></div>
      </div>

      <button class="btn btn-secondary" id="btn-badges-back">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
    </section>

    <!-- Leaderboard screen -->
    <section class="screen" id="screen-leaderboard">
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">–†–µ–π—Ç–∏–Ω–≥ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
            <div class="card-subtitle">
              –í –ø—Ä–æ–¥–µ ‚Äî —Ä–µ–∞–ª—å–Ω—ã–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º. –ó–¥–µ—Å—å ‚Äî –¥–µ–º–æ –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞, –µ—Å–ª–∏ –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω.
            </div>
          </div>
          <div class="pill-inline">
            üèÜ <span id="leaderboard-me-rating">–†–µ–π—Ç–∏–Ω–≥: 100</span>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="leader-header-row">
          <span>–ú–µ—Å—Ç–æ</span>
          <span>–ò–º—è</span>
          <span>–†–µ–π—Ç–∏–Ω–≥</span>
        </div>
        <div class="leader-list" id="leaderboard-list"></div>
      </div>

      <button class="btn btn-secondary" id="btn-leaderboard-back">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
    </section>
  </main>
</div>

<!-- overlay: –≤–≤–æ–¥ –∏–º–µ–Ω–∏ -->
<div class="overlay" id="name-overlay">
  <div class="overlay-card">
    <div class="section-title">–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?</div>
    <p style="font-size:13px;opacity:0.8;margin-bottom:8px;">
      –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Telegram-–∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –∞ –∏–º—è –≤ –∏–≥—Ä–µ –≤—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å —Ç–∞–∫,
      –∫–∞–∫ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –æ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–æ—Å—å –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ.
    </p>
    <input id="name-input" type="text" placeholder="–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è"
           style="width:100%;padding:9px 10px;border-radius:999px;border:1px solid var(--border-soft);font-size:14px;outline:none;margin-bottom:8px;">
    <button class="btn btn-primary btn-small" id="btn-name-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>
</div>

<script>
  // ---------- –í–û–ü–†–û–°–´ ----------
  const questionBank = [
    {
      text: "–ö–∞–∫–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å –°–ò–ë–£–†–∞ –æ–∑–Ω–∞—á–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –∏ –æ—Ö—Ä–∞–Ω—ã —Ç—Ä—É–¥–∞?",
      category: "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å",
      options: [
        "–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —ç–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤",
        "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å",
        "–ö–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞",
        "–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–µ—Ä–≤–∏—Å"
      ],
      correctIndex: 1
    },
    {
      text: "–ß—Ç–æ –∏–∑ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ –ª—É—á—à–µ –≤—Å–µ–≥–æ –æ—Ç—Ä–∞–∂–∞–µ—Ç –∫—É—Ä—Å –°–ò–ë–£–†–∞ –Ω–∞ —É—Å—Ç–æ–π—á–∏–≤–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ?",
      category: "–≠–∫–æ–ª–æ–≥–∏—è –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å",
      options: [
        "–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –æ–±—ä—ë–º–æ–≤ –ª—é–±—ã—Ö –≤–∏–¥–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞",
        "–û—Ç–∫–∞–∑ –æ—Ç —Ü–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏–∏",
        "–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª–∏–º–µ—Ä–æ–≤ –∏ —Å–Ω–∏–∂–µ–Ω–∏–µ –≤—ã–±—Ä–æ—Å–æ–≤",
        "–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –æ–±—É—á–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤"
      ],
      correctIndex: 2
    },
    {
      text: "–ß—Ç–æ –≤ –±–æ–ª—å—à–µ–π —Å—Ç–µ–ø–µ–Ω–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏–Ω–Ω–æ–≤–∞—Ü–∏—è–º –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ?",
      category: "–ò–Ω–Ω–æ–≤–∞—Ü–∏–∏",
      options: [
        "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π",
        "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞",
        "–ó–∞–ø—Ä–µ—Ç –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—è–º",
        "–°–æ–∫—Ä—ã—Ç–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤"
      ],
      correctIndex: 1
    },
    {
      text: "–ß—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–º–µ—Ä–æ–º –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–∏?",
      category: "–ö–æ–º–∞–Ω–¥–Ω–æ—Å—Ç—å",
      options: [
        "–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –∫–æ–ª–ª–µ–≥",
        "–°–æ–≤–º–µ—Å—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –º–µ–∂–¥—É —Ü–µ—Ö–∞–º–∏",
        "–°–æ–∫—Ä—ã—Ç–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏",
        "–†–∞–±–æ—Ç–∞ —Ç–æ–ª—å–∫–æ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É ¬´–º–æ—è —Å–º–µ–Ω–∞ ‚Äî –º–æ–∏ –∑–∞–¥–∞—á–∏¬ª"
      ],
      correctIndex: 1
    },
    {
      text: "–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏?",
      category: "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å",
      options: [
        "–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π",
        "–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å, –Ω–∞—Ä—É—à–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
        "–°–æ–æ–±—â–∏—Ç—å –ø–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–º—É –∫–∞–Ω–∞–ª—É –∏ –ø—Ä–∏–Ω—è—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–µ—Ä—ã",
        "–ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å, –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã ‚Äî –Ω–æ—Ä–º–∞"
      ],
      correctIndex: 2
    },
    {
      text: "–ö–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–º–æ–≥–∞–µ—Ç —Å–Ω–∏–∂–∞—Ç—å –æ—Ç—Ö–æ–¥—ã –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞?",
      category: "–≠–∫–æ–ª–æ–≥–∏—è –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å",
      options: [
        "–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏",
        "–°–∏—Å—Ç–µ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–µ",
        "–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –æ–±—ä—ë–º–∞ —É–ø–∞–∫–æ–≤–∫–∏",
        "–û—Ç–∫–∞–∑ –æ—Ç —É—á—ë—Ç–∞ –æ—Ç—Ö–æ–¥–æ–≤"
      ],
      correctIndex: 1
    },
    {
      text: "–ß—Ç–æ —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏ –Ω–∞ —Ä–∞–±–æ—á–µ–º –º–µ—Å—Ç–µ?",
      category: "–ò–Ω–Ω–æ–≤–∞—Ü–∏–∏",
      options: [
        "–û–±–º–µ–Ω –∏–¥–µ—è–º–∏ –∏ –ø–æ–¥–∞—á–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—è–º",
        "–ó–∞–ø—Ä–µ—Ç –Ω–∞ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∏–¥–µ–π",
        "–û–∂–∏–¥–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ç–æ–ª—å–∫–æ ¬´—Å–≤–µ—Ä—Ö—É¬ª",
        "–ò–∑–æ–ª—è—Ü–∏—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞"
      ],
      correctIndex: 0
    }
  ];

  const badgesConfig = [
    {
      id: "rookie",
      title: "–ù–æ–≤–∏—á–æ–∫ —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π",
      description: "–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ 120 –∏ —Å—ã–≥—Ä–∞–π—Ç–µ 3 –¥—É—ç–ª–∏.",
      condition: (p) => p.rating >= 120 && p.battles >= 3
    },
    {
      id: "safety",
      title: "–ó–Ω–∞—Ç–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏",
      description: "–û—Ç–≤–µ—Ç—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –º–∏–Ω–∏–º—É–º –≤ 5 –≤–æ–ø—Ä–æ—Å–∞—Ö –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.",
      condition: (p) => p.stats.safetyCorrect >= 5
    },
    {
      id: "eco",
      title: "–≠–∫–æ-–≥–µ—Ä–æ–π",
      description: "–û—Ç–≤–µ—Ç—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –º–∏–Ω–∏–º—É–º –≤ 5 –≤–æ–ø—Ä–æ—Å–∞—Ö –ø–æ —ç–∫–æ–ª–æ–≥–∏–∏.",
      condition: (p) => p.stats.ecoCorrect >= 5
    },
    {
      id: "innovator",
      title: "–ò–Ω–Ω–æ–≤–∞—Ç–æ—Ä",
      description: "–û—Ç–≤–µ—Ç—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –º–∏–Ω–∏–º—É–º –≤ 5 –≤–æ–ø—Ä–æ—Å–∞—Ö –ø–æ –∏–Ω–Ω–æ–≤–∞—Ü–∏—è–º.",
      condition: (p) => p.stats.innovationCorrect >= 5
    },
    {
      id: "duelist",
      title: "–ú–∞—Å—Ç–µ—Ä –¥—É—ç–ª–µ–π",
      description: "–í—ã–∏–≥—Ä–∞–π—Ç–µ 10 –¥—É—ç–ª–µ–π.",
      condition: (p) => p.wins >= 10
    }
  ];

  const sampleOpponents = [
    { name: "–ò—Ä–∏–Ω–∞, –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è", rating: 130, initials: "–ò–†" },
    { name: "–ê–Ω–¥—Ä–µ–π, –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ", rating: 145, initials: "–ê–ü" },
    { name: "–°–µ—Ä–≥–µ–π, —Ü–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏—è", rating: 160, initials: "–°–¶" },
    { name: "–ú–∞—Ä–∏—è, —ç–∫–æ–ª–æ–≥–∏—è", rating: 155, initials: "–ú–≠" }
  ];

  const demoLeaderboard = [
    { name: "–ê–Ω—Ç–æ–Ω, –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ", rating: 180, battles: 14, wins: 9 },
    { name: "–ú–∞—Ä–∏–Ω–∞, —Ñ–∏–Ω–∞–Ω—Å—ã",     rating: 165, battles: 11, wins: 7 },
    { name: "–ò–≥–æ—Ä—å, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å", rating: 150, battles: 9,  wins: 6 },
    { name: "–û–ª—å–≥–∞, HR",           rating: 135, battles: 6,  wins: 3 },
    { name: "–î–º–∏—Ç—Ä–∏–π, –ò–¢",         rating: 120, battles: 5,  wins: 3 }
  ];

  // ---------- –ó–í–£–ö–ò (Web Audio) ----------
  const Sound = (() => {
    let ctx = null;
    let unlocked = false;

    function ensureContext() {
      if (!ctx) {
        const AC = window.AudioContext || window.webkitAudioContext;
        if (!AC) return null;
        ctx = new AC();
      }
      if (ctx.state === "suspended") ctx.resume();
      unlocked = true;
      return ctx;
    }

    function beep(freq, duration, type = "sine", volume = 0.12) {
      const audioCtx = ensureContext();
      if (!audioCtx || !unlocked) return;
      const now = audioCtx.currentTime;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = type;
      osc.frequency.value = freq;
      gain.gain.setValueAtTime(volume, now);
      gain.gain.exponentialRampToValueAtTime(0.001, now + duration);
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.start(now);
      osc.stop(now + duration + 0.02);
    }

    return {
      unlock() { ensureContext(); },
      correct() { beep(880, 0.12, "triangle", 0.18); },
      wrong() { beep(220, 0.18, "sawtooth", 0.22); },
      tick() { beep(1300, 0.05, "square", 0.12); },
      finishWin() { beep(1040, 0.16, "triangle", 0.2); setTimeout(() => beep(1320,0.18,"triangle",0.18),120); },
      finishLose() { beep(260,0.18,"sine",0.18); }
    };
  })();

  // ---------- API-–û–ë–Å–†–¢–ö–ê ----------
  const Api = (() => {
    let serverAvailable = false;

    async function checkServer() {
      try {
        const res = await fetch("/api/profile/me", { method: "GET", credentials: "include" });
        if (!res.ok) throw new Error("status " + res.status);
        serverAvailable = true;
        return true;
      } catch (e) {
        serverAvailable = false;
        console.warn("API not available, using local demo mode", e);
        return false;
      }
    }

    async function getProfile(localPlayer) {
      if (!serverAvailable) return null;
      try {
        const res = await fetch("/api/profile/me", { credentials: "include" });
        if (!res.ok) throw new Error("status " + res.status);
        return await res.json();
      } catch (e) {
        console.warn("getProfile failed, fallback to local", e);
        return null;
      }
    }

    async function finishDuel(payload) {
      if (!serverAvailable) return null;
      try {
        const res = await fetch("/api/duels/finish", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error("status " + res.status);
        return await res.json();
      } catch (e) {
        console.warn("finishDuel failed, fallback to local", e);
        return null;
      }
    }

    async function getLeaderboard() {
      if (!serverAvailable) return null;
      try {
        const res = await fetch("/api/leaderboard?limit=50", { credentials: "include" });
        if (!res.ok) throw new Error("status " + res.status);
        return await res.json();
      } catch (e) {
        console.warn("getLeaderboard failed, fallback to demo", e);
        return null;
      }
    }

    return {
      serverAvailable: () => serverAvailable,
      checkServer,
      getProfile,
      finishDuel,
      getLeaderboard
    };
  })();

  // ---------- –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–û–ö–ê ----------
  let player = {
    tgId: null,
    name: "–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –°–ò–ë–£–†",
    avatarUrl: null,
    rating: 100,
    battles: 0,
    wins: 0,
    losses: 0,
    draws: 0,
    stats: {
      safetyCorrect: 0,
      ecoCorrect: 0,
      innovationCorrect: 0
    },
    badges: []
  };

  let gameState = {
    mode: "quick",
    opponent: null,
    questions: [],
    currentQuestionIndex: 0,
    playerScore: 0,
    opponentScore: 0,
    timerInterval: null,
    timerTimeout: null,
    timerTotalMs: 10000,
    questionAnswered: false
  };

  function $(id) { return document.getElementById(id); }

  function initialsFromName(name) {
    if (!name) return "S";
    const parts = name.split(" ").filter(Boolean);
    if (parts.length === 0) return name[0].toUpperCase();
    if (parts.length === 1) return parts[0][0].toUpperCase();
    return (parts[0][0] + parts[1][0]).toUpperCase();
  }

  function ratingLabel(rating) {
    if (rating < 120) return "–ù–æ–≤–∏—á–æ–∫";
    if (rating < 150) return "–£—á–∞—Å—Ç–Ω–∏–∫";
    if (rating < 200) return "–°–∏–ª—å–Ω—ã–π –∏–≥—Ä–æ–∫";
    if (rating < 250) return "–≠–∫—Å–ø–µ—Ä—Ç";
    return "–õ–µ–≥–µ–Ω–¥–∞";
  }

  function battlesLabel(battles) {
    if (battles === 0) return "0 –¥—É—ç–ª–µ–π";
    if (battles === 1) return "1 –¥—É—ç–ª—å";
    if (battles < 5) return battles + " –¥—É—ç–ª–∏";
    return battles + " –¥—É—ç–ª–µ–π";
  }

  function switchScreen(id) {
    document.querySelectorAll(".screen").forEach(el => {
      el.classList.toggle("active", el.id === id);
    });
  }

  function shuffle(array) {
    const arr = array.slice();
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function storageKey() {
    return player.tgId ? "sibur_quiz_player_" + player.tgId : "sibur_quiz_demo_player";
  }

  function savePlayerLocal() {
    try {
      localStorage.setItem(storageKey(), JSON.stringify(player));
    } catch (e) {}
  }

  function loadPlayerLocal(tgId) {
    let raw = null;
    if (tgId) {
      raw = localStorage.getItem("sibur_quiz_player_" + tgId);
    }
    if (!raw) {
      raw = localStorage.getItem("sibur_quiz_demo_player");
    }
    if (!raw) return;
    try {
      const data = JSON.parse(raw);
      player = Object.assign(player, data);
    } catch (e) {}
  }

  function updateMainScreen() {
    $("player-name").textContent = player.name;
    const avatarEl = $("player-avatar");
    avatarEl.innerHTML = "";
    if (player.avatarUrl) {
      const img = document.createElement("img");
      img.src = player.avatarUrl;
      avatarEl.appendChild(img);
    } else {
      avatarEl.textContent = initialsFromName(player.name);
    }
    $("player-meta").textContent = `–†–µ–π—Ç–∏–Ω–≥: ${player.rating} ¬∑ –î—É—ç–ª–µ–π: ${player.battles}`;
    $("player-rating-label").textContent = ratingLabel(player.rating);
    $("player-battles-label").textContent = battlesLabel(player.battles);
  }

  function updateBadgesFromPlayer() {
    const unlockedIds = [];
    badgesConfig.forEach(b => {
      if (b.condition(player)) unlockedIds.push(b.id);
    });
    player.badges = unlockedIds;
  }

  function renderBadges() {
    updateBadgesFromPlayer();
    const container = $("badge-grid");
    container.innerHTML = "";
    const unlockedSet = new Set(player.badges);
    badgesConfig.forEach(badge => {
      const card = document.createElement("div");
      const unlocked = unlockedSet.has(badge.id);
      card.className = "badge-card" + (unlocked ? "" : " locked");

      const title = document.createElement("div");
      title.textContent = badge.title;
      title.style.fontWeight = "600";
      card.appendChild(title);

      const desc = document.createElement("div");
      desc.textContent = badge.description;
      desc.style.fontSize = "11px";
      desc.style.opacity = "0.8";
      card.appendChild(desc);

      const pill = document.createElement("div");
      pill.className = "badge-pill";
      pill.textContent = unlocked ? "–û—Ç–∫—Ä—ã—Ç–æ" : "–ü–æ–∫–∞ –∑–∞–∫—Ä—ã—Ç–æ";
      card.appendChild(pill);

      container.appendChild(card);
    });

    $("badges-count-label").textContent = `${player.badges.length} –∏–∑ ${badgesConfig.length}`;
  }

  function renderLeaderboard(serverData) {
    const container = $("leaderboard-list");
    container.innerHTML = "";

    let players;
    if (serverData && serverData.items) {
      players = serverData.items.slice();
    } else {
      players = demoLeaderboard.map(p => ({ ...p }));
      players.push({
        name: player.name + " (–≤—ã)",
        rating: player.rating,
        battles: player.battles,
        wins: player.wins
      });
      players.sort((a, b) => b.rating - a.rating);
    }

    players.forEach((p, idx) => {
      const row = document.createElement("div");
      const isMe = p.name.includes("(–≤—ã)") || (serverData && serverData.me && serverData.me.position === idx + 1);
      row.className = "leader-row" + (isMe ? " me" : "");

      const pos = document.createElement("div");
      pos.className = "leader-pos";
      pos.textContent = serverData && p.position ? p.position : (idx + 1);
      row.appendChild(pos);

      const nameCol = document.createElement("div");
      nameCol.className = "leader-name";
      const main = document.createElement("div");
      main.className = "leader-name-main";
      main.textContent = p.name;
      const sub = document.createElement("div");
      sub.className = "leader-name-sub";
      sub.textContent = `–î—É—ç–ª–µ–π: ${p.battles || 0}, –ø–æ–±–µ–¥: ${p.wins || 0}`;
      nameCol.appendChild(main);
      nameCol.appendChild(sub);
      row.appendChild(nameCol);

      const score = document.createElement("div");
      score.className = "leader-score";
      score.textContent = p.rating;
      row.appendChild(score);

      container.appendChild(row);
    });

    $("leaderboard-me-rating").textContent = `–†–µ–π—Ç–∏–Ω–≥: ${player.rating}`;
  }

  function resetTimer() {
    if (gameState.timerInterval) {
      clearInterval(gameState.timerInterval);
      gameState.timerInterval = null;
    }
    if (gameState.timerTimeout) {
      clearTimeout(gameState.timerTimeout);
      gameState.timerTimeout = null;
    }
  }

  function prepareDuel(mode) {
    gameState.mode = mode;
    gameState.questions = shuffle(questionBank).slice(0, 5);
    gameState.currentQuestionIndex = 0;
    gameState.playerScore = 0;
    gameState.opponentScore = 0;
    gameState.questionAnswered = false;

    const opp = sampleOpponents[Math.floor(Math.random() * sampleOpponents.length)];
    gameState.opponent = {
      name: mode === "bot" ? opp.name + " (–ò–ò)" : opp.name,
      rating: opp.rating,
      initials: opp.initials
    };

    $("duel-mode-label").textContent = mode === "bot"
      ? "–†–µ–∂–∏–º: –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å –ò–ò-—Å–æ–ø–µ—Ä–Ω–∏–∫–æ–º"
      : "–†–µ–∂–∏–º: –ë—ã—Å—Ç—Ä–∞—è –¥—É—ç–ª—å";
    $("duel-player-name").textContent = "–í—ã";
    $("duel-player-rating").textContent = player.rating;

    const playerAvatar = $("duel-player-avatar");
    playerAvatar.innerHTML = "";
    if (player.avatarUrl) {
      const img = document.createElement("img");
      img.src = player.avatarUrl;
      playerAvatar.appendChild(img);
    } else {
      playerAvatar.textContent = initialsFromName(player.name);
    }

    $("duel-opponent-name").textContent = gameState.opponent.name;
    $("duel-opponent-rating").textContent = gameState.opponent.rating;
    $("duel-opponent-avatar").textContent = gameState.opponent.initials;

    $("duel-hint").textContent = "–ö–∞–∂–¥—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç –≤–∞—Å –∫ –Ω–æ–≤—ã–º –±–µ–π–¥–∂–∞–º –∏ –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–º—É —Ä–µ–π—Ç–∏–Ω–≥—É.";

    showQuestion();
  }

  function showQuestion() {
    resetTimer();
    const idx = gameState.currentQuestionIndex;
    const q = gameState.questions[idx];
    $("duel-progress-label").textContent = `–í–æ–ø—Ä–æ—Å ${idx + 1} / ${gameState.questions.length}`;
    $("duel-score-label").textContent = `${gameState.playerScore} : ${gameState.opponentScore}`;
    $("question-text").textContent = q.text;
    $("question-meta").textContent = `–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${q.category}`;
    const container = $("answers-container");
    container.innerHTML = "";
    gameState.questionAnswered = false;

    q.options.forEach((opt, i) => {
      const btn = document.createElement("button");
      btn.className = "answer-btn";
      btn.dataset.index = String(i);

      const idxSpan = document.createElement("span");
      idxSpan.className = "index";
      idxSpan.textContent = String.fromCharCode(65 + i);
      btn.appendChild(idxSpan);

      const textSpan = document.createElement("span");
      textSpan.className = "text";
      textSpan.textContent = opt;
      btn.appendChild(textSpan);

      btn.addEventListener("click", () => handlePlayerAnswer(i, btn));
      container.appendChild(btn);
    });

    const timerFill = $("timer-fill");
    timerFill.style.transform = "scaleX(1)";
    timerFill.style.filter = "none";
    const total = gameState.timerTotalMs;
    const start = performance.now();

    gameState.timerInterval = setInterval(() => {
      const now = performance.now();
      const elapsed = now - start;
      const ratio = Math.max(0, 1 - elapsed / total);
      timerFill.style.transform = `scaleX(${ratio})`;
      if (ratio < 0.3) {
        timerFill.style.filter = "brightness(1.05) saturate(1.1)";
        Sound.tick();
      }
    }, 900);

    gameState.timerTimeout = setTimeout(() => {
      if (!gameState.questionAnswered) {
        handlePlayerAnswer(null, null, true);
      }
    }, total);

    simulateOpponentAnswer(q);
  }

  function simulateOpponentAnswer(question) {
    const baseDelay = 1300;
    const extra = Math.random() * 2500;
    const delay = baseDelay + extra;
    const willAnswerCorrect = Math.random() < 0.7;
    setTimeout(() => {
      const idx = gameState.questions.indexOf(question);
      if (idx === -1 || idx !== gameState.currentQuestionIndex) return;
      if (!gameState.questionAnswered) {
        if (willAnswerCorrect) {
          gameState.opponentScore++;
        }
        $("duel-score-label").textContent = `${gameState.playerScore} : ${gameState.opponentScore}`;
      }
    }, delay);
  }

  async function handlePlayerAnswer(optionIndex, btn, isTimeout = false) {
    if (gameState.questionAnswered) return;
    gameState.questionAnswered = true;
    resetTimer();

    const q = gameState.questions[gameState.currentQuestionIndex];
    const correctIdx = q.correctIndex;
    const answersButtons = Array.from(document.querySelectorAll("#answers-container .answer-btn"));

    answersButtons.forEach((b) => {
      b.classList.add("disabled");
      const idx = parseInt(b.dataset.index, 10);
      if (idx === correctIdx) {
        b.classList.add("correct");
      }
    });

    let playerCorrect = false;

    if (optionIndex !== null && optionIndex === correctIdx) {
      playerCorrect = true;
      gameState.playerScore++;
      if (btn) btn.classList.add("correct");
      Sound.correct();
    } else if (optionIndex !== null && optionIndex !== correctIdx) {
      if (btn) btn.classList.add("wrong");
      Sound.wrong();
    }

    $("duel-score-label").textContent = `${gameState.playerScore} : ${gameState.opponentScore}`;

    if (playerCorrect) {
      if (q.category.includes("–ë–µ–∑–æ–ø–∞—Å")) {
        player.stats.safetyCorrect++;
      } else if (q.category.includes("–≠–∫–æ–ª–æ–≥")) {
        player.stats.ecoCorrect++;
      } else if (q.category.includes("–ò–Ω–Ω–æ–≤–∞—Ü")) {
        player.stats.innovationCorrect++;
      }
    }

    savePlayerLocal();

    setTimeout(() => {
      gameState.currentQuestionIndex++;
      if (gameState.currentQuestionIndex >= gameState.questions.length) {
        finishDuel();
      } else {
        showQuestion();
      }
    }, 900);
  }

  async function finishDuel() {
    resetTimer();
    const playerScore = gameState.playerScore;
    const opponentScore = gameState.opponentScore;
    const mode = gameState.mode;

    let statusText = "";
    let deltaRating = 0;

    player.battles++;

    if (playerScore > opponentScore) {
      statusText = "–ü–æ–±–µ–¥–∞ üéâ";
      player.wins++;
      deltaRating = mode === "quick" ? 15 : 5;
      Sound.finishWin();
    } else if (playerScore < opponentScore) {
      statusText = "–ü–æ—Ä–∞–∂–µ–Ω–∏–µ ‚Äî –Ω–æ –æ–ø—ã—Ç –µ—Å—Ç—å üí™";
      player.losses++;
      deltaRating = mode === "quick" ? 5 : 3;
      Sound.finishLose();
    } else {
      statusText = "–ù–∏—á—å—è ü§ù";
      player.draws++;
      deltaRating = mode === "quick" ? 10 : 4;
      Sound.finishWin();
    }

    player.rating += deltaRating;
    if (player.rating < 0) player.rating = 0;

    updateBadgesFromPlayer();
    savePlayerLocal();

    // –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
    if (Api.serverAvailable()) {
      try {
        const payload = {
          mode,
          score_user: playerScore,
          score_opponent: opponentScore,
          categories_correct: gameState.questions.map((q, idx) => ({
            category: q.category,
            correct: idx < gameState.currentQuestionIndex // —É–ø—Ä–æ—â—ë–Ω–Ω–æ
          }))
        };
        const serverResult = await Api.finishDuel(payload);
        if (serverResult && typeof serverResult.new_rating === "number") {
          player.rating = serverResult.new_rating;
          deltaRating = serverResult.rating_delta || deltaRating;
          player.battles = serverResult.battles ?? player.battles;
          player.wins = serverResult.wins ?? player.wins;
          player.losses = serverResult.losses ?? player.losses;
          player.draws = serverResult.draws ?? player.draws;
          if (serverResult.badges) {
            player.badges = serverResult.badges.map(b => b.code);
          }
          savePlayerLocal();
        }
      } catch (e) {
        console.warn("finishDuel server sync failed", e);
      }
    }

    $("result-score").textContent = `${playerScore} : ${opponentScore}`;
    $("result-status-label").textContent = statusText;
    $("result-delta-label").textContent = `–†–µ–π—Ç–∏–Ω–≥: ${deltaRating >= 0 ? "+" : ""}${deltaRating} ¬∑ –î—É—ç–ª–µ–π: +1`;
    $("result-rating-value").textContent = player.rating;
    $("result-battles-value").textContent = player.battles;
    $("result-wl-value").textContent = `${player.wins} / ${player.losses} / ${player.draws}`;

    $("result-mode-pill").textContent = mode === "quick" ? "–ë—ã—Å—Ç—Ä–∞—è –¥—É—ç–ª—å" : "–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞";
    $("result-subtitle").textContent =
      Api.serverAvailable()
        ? "–†–µ–∑—É–ª—å—Ç–∞—Ç —É–∂–µ —É—á—Ç—ë–Ω –≤ –æ–±—â–µ–º —Å–µ—Ä–≤–µ—Ä–Ω–æ–º —Ä–µ–π—Ç–∏–Ω–≥–µ."
        : "–°–µ–π—á–∞—Å –≤—ã –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ. –ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å –º–æ–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å.";

    switchScreen("screen-result");
  }

  function initTelegram() {
    let tg = null;
    if (window.Telegram && window.Telegram.WebApp) {
      tg = window.Telegram.WebApp;
      tg.ready();
      const user = tg.initDataUnsafe && tg.initDataUnsafe.user;
      if (user) {
        player.tgId = user.id;
        player.avatarUrl = user.photo_url || null;
        loadPlayerLocal(player.tgId);
        if (!player.name || player.name === "–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –°–ò–ë–£–†") {
          player.name = user.first_name + (user.last_name ? " " + user.last_name : "");
        }
        savePlayerLocal();
        $("splash-info").textContent = "–ú—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ –≤–∞—Å –ø–æ –∞–∫–∫–∞—É–Ω—Ç—É Telegram. –ù–∞–∂–º–∏—Ç–µ ¬´–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å¬ª, —á—Ç–æ–±—ã –≤–æ–π—Ç–∏ –≤ –∏–≥—Ä—É.";
      }
    } else {
      loadPlayerLocal(null);
    }
  }

  function showNameOverlayIfNeeded() {
    if (!player.name || player.name === "–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –°–ò–ë–£–†") {
      $("name-input").value = "";
      $("name-overlay").classList.add("active");
    } else {
      updateMainScreen();
      switchScreen("screen-main");
    }
  }

  async function init() {
    initTelegram();
    updateMainScreen();

    document.body.addEventListener("click", () => {
      Sound.unlock();
    }, { once: true });

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ä–≤–µ—Ä —Ñ–æ–Ω–æ–º
    Api.checkServer().then(ok => {
      if (ok) {
        $("splash-footer").textContent = "–°—Ç–∞—Ç—É—Å: —Å–µ—Ä–≤–µ—Ä —Ä–µ–π—Ç–∏–Ω–≥–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω. –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ.";
      } else {
        $("splash-footer").textContent = "–°—Ç–∞—Ç—É—Å: —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏–≥—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ.";
      }
    });

    $("btn-enter").addEventListener("click", () => {
      showNameOverlayIfNeeded();
    });

    $("btn-demo-name").addEventListener("click", () => {
      $("name-input").value = player.name === "–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –°–ò–ë–£–†" ? "" : player.name;
      $("name-overlay").classList.add("active");
    });

    $("btn-name-save").addEventListener("click", () => {
      const name = $("name-input").value.trim();
      if (!name) return;
      player.name = name;
      savePlayerLocal();
      $("name-overlay").classList.remove("active");
      updateMainScreen();
      switchScreen("screen-main");
    });

    $("btn-play-quick").addEventListener("click", () => {
      prepareDuel("quick");
      switchScreen("screen-duel");
    });

    $("btn-play-bot").addEventListener("click", () => {
      prepareDuel("bot");
      switchScreen("screen-duel");
    });

    $("menu-badges").addEventListener("click", () => {
      renderBadges();
      switchScreen("screen-badges");
    });

    $("menu-leaderboard").addEventListener("click", async () => {
      let serverData = null;
      if (Api.serverAvailable()) {
        serverData = await Api.getLeaderboard();
      }
      renderLeaderboard(serverData);
      switchScreen("screen-leaderboard");
    });

    $("btn-duel-exit").addEventListener("click", () => {
      resetTimer();
      updateMainScreen();
      switchScreen("screen-main");
    });

    $("btn-duel-skip").addEventListener("click", () => {
      resetTimer();
      finishDuel();
    });

    $("btn-result-again").addEventListener("click", () => {
      updateMainScreen();
      prepareDuel("quick");
      switchScreen("screen-duel");
    });

    $("btn-result-main").addEventListener("click", () => {
      updateMainScreen();
      switchScreen("screen-main");
    });

    $("btn-badges-back").addEventListener("click", () => {
      updateMainScreen();
      switchScreen("screen-main");
    });

    $("btn-leaderboard-back").addEventListener("click", () => {
      updateMainScreen();
      switchScreen("screen-main");
    });
  }

  document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
